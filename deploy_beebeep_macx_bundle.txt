#!/bin/bash
echo "Making BeeBEEP Bundle..."

SOURCE_DIR=beebeep-code
echo "Source folder:" $SOURCE_DIR

BUNDLE_APP=BeeBEEP.app
echo "Bundle folder:" $BUNDLE_APP

MACDEPLOY_APP=./Qt/5.4/clang_64/bin/macdeployqt
echo "Mac Deploy App:" $MACDEPLOY_APP

# delete previous bundle folder
printf "Delete previous bundle folder ... "
rm -rf $BUNDLE_APP
echo "Done"

# delete previous bundle dmg
printf "Delete previous beebeep.dmg ... "
rm -f beebeep.dmg
echo "Done"

#copy beebeep.app from release
printf "Copy beebeep.app ... "
cp -R $SOURCE_DIR/test/$BUNDLE_APP .
echo "Done"

#clean up
printf "Clean up folders and files ... "
rm -f $BUNDLE_APP/Contents/Resources/beebeep.ini
rm -f $BUNDLE_APP/Contents/Resources/beebeep.dat
rm -f $BUNDLE_APP/Contents/Resources/beebeep.rc
rm -f $BUNDLE_APP/Contents/Resources/qt.conf
echo "Done"

#create folders
printf "Create folders ... "
mkdir $BUNDLE_APP/Contents/Frameworks
mkdir $BUNDLE_APP/Contents/PlugIns
echo "Done"

#copy Info.plist
printf "Copy Info.plist ... "
cp $SOURCE_DIR/misc/Info.plist $BUNDLE_APP/Contents/.
echo "Done"

#copy beep.wav
printf "Copy beep.wav ... "
cp $SOURCE_DIR/misc/beep.wav $BUNDLE_APP/Contents/Resources/.
echo "Done"

#copy beehosts.ini
printf "Copy beehosts.ini ... "
cp $SOURCE_DIR/misc/beehosts.ini $BUNDLE_APP/Contents/Resources/.
echo "Done"

#copy locale
printf "Copy translations ... "
cp $SOURCE_DIR/locale/*.qm $BUNDLE_APP/Contents/Resources/.
echo "Done"

#copy plugins
printf "Copy plugins ... "
cp $SOURCE_DIR/test/*.1.0.0.dylib $BUNDLE_APP/Contents/PlugIns/.
echo "Done"

#mac deploy frameworks
printf "MacOS X deploy and create DMG file ... "
$MACDEPLOY_APP $BUNDLE_APP -dmg
echo "Done"

echo "BeeBEEP to Bundle - Process completed."
